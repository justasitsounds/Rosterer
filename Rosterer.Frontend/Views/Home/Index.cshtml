@using Rosterer.Frontend.Models
@model HomeModel

<div>
    <div id="control" class="linkbutton" style="float:right">+</div>
    <h2 id="thisMonth"></h2>
    
</div>
<div class="roster">
    <div id="progress"><img src="/Content/Images/ajax-loader.gif" alt="" /></div>
</div>
<div class="controlpanel">
    <h3>Controls</h3>
    <h4>Users</h4>
    <ul>
        <li>Book time off</li>
        <li>Print</li>
    </ul>
    <h4>Admin Only</h4>
    <ul>
        <li>@Html.ActionLink("Create new user","Register","Account")</li>
        <li>Create new event</li>
    </ul>
    <h5>Filter</h5>
    <fieldset>
        <legend>Users</legend>
        <ul>
            @foreach(var staffmember in Model.Staff)
            {
                <li style="background-color: @System.Drawing.ColorTranslator.ToHtml(staffmember.Color)">
                    <input type="checkbox" name="staff" value="@staffmember.Id" checked="checked"/> @staffmember.Initials
                </li>
            }
        </ul>
    </fieldset>
    <fieldset>
        <legend>Venues</legend>
        <ul>
            @foreach (var venueModel in Model.Venues)
            {
                <li>
                    <input type="checkbox" name="staff" value="@venueModel.Id" checked="checked"/> @venueModel.Name
                </li>
            }
        </ul>
    </fieldset>
</div>

<div id="venueform" title="New Venue">
    @{ Html.RenderPartial("VenueForm", new VenueModel()); }
</div>

<div id="eventform" title="Event">
   
</div>
@*<h2>Date</h2>
<input type="text" class="date"/>*@
@section Scripts
{
<script type="text/javascript " src="/Scripts/isodate.js"></script>
    <script type="text/javascript">

        var CloseVenueModal = function () {
            $("#venueform").dialog('close');
        };

        var CloseEventModal = function () {
            $("#eventform").dialog('close');
            $('#eventform').html();
        };

        var showProgress = function (element) {
            $('#progress').show();
        };
        var hideProgress = function() {
            $('#progress').hide();
        };

        var PopulateWeek = function (year, week) {  
            //showProgress($(".roster"));
            $.ajax({
                type: "GET",
                url: "Week?year=" + year + "&week=" + week,
                async: false,
                success: function (result) {
                    $(".roster").append(result);
                    hideProgress();
                }
            });

        };

        $(document).ready(function () {

            var d = new Date();
            var newdate = new Date(d.getFullYear(), d.getMonth(), 1, 0, 0, 0, 1);
            var weeknumber = newdate.getWeek(1);
            for (var i = weeknumber; i <= weeknumber + 4; i++)
                PopulateWeek(newdate.getFullYear(), i);
            $('#thisMonth').html(newdate.getMonthName() + ' ' + newdate.getFullYear());


            $(".roster .week .day .addevent").click(
                function () {
                    $("#eventform").dialog('open');
                    $.ajax({
                        type: "GET",
                        url: "Event/Create",
                        data: { startDate: $(this).parent().attr('title') },
                        async: false,

                        success: function (result) {
                            // Replace the div's content with the page method's return.
                            $("#eventform").html(result);
                            $('.date').not('.hasDatePicker').datetimepicker();
                        }
                    });
                }

            );

            //$('.date').datetimepicker();

            var controlsOpen = false;
            $("#control").click(function () {
                if (controlsOpen) {
                    $(".controlpanel").hide().animate({ width: "0%" }, 400);
                    $(".roster").animate({ width: "100%" }, 400);
                    $(this).html("+");
                    controlsOpen = false;
                } else {
                    $(".controlpanel").animate({ width: "19%" }, 400, function () { $(this).show(); });
                    $(".roster").animate({ width: "80%" }, 400);
                    $(this).html("-");
                    controlsOpen = true;
                }
            });

            $("#venueform, #eventform").dialog({
                autoOpen: false,
                height: 700,
                width: 500,
                modal: true
            });

            $("#openVenueForm").click(function () {
                $("#venueform").dialog('open');
            });

            $("#closeVenueForm").click(function () {
                CloseVenueModal();
            });
        });
    </script>
}